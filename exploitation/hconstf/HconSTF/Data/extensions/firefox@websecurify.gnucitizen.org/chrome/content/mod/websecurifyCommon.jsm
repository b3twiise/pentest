var EXPORTED_SYMBOLS=["websecurifyCommon"],CR=Components.results,CC=Components.classes,CI=Components.interfaces;Components.utils.import("resource://gre/modules/Services.jsm");
var websecurifyCommon=new function(){this.getDomainWhitelist=function(){var b={};Services.prefs.getChildList("org.gnucitizen.websecurify.firefox.whitelist.").forEach(function(c){var a=c.substring(45,c.length).split(".");if(2!=a.length)Components.utils.reportError(Error("unrecognized structure for key "+c));else{var d=a[0];try{d=parseInt(d,10)}catch(e){Components.utils.reportError(Error("unrecognized index for key "+c));return}a=a[1];a in{domain:1,sslonly:1}?(d in b||(b[d]={}),"domain"==a?b[d][a]=
Services.prefs.getCharPref(c).trim():"sslonly"==a&&(b[d][a]=Services.prefs.getBoolPref(c))):Components.utils.reportError(Error("unrecognized type for key "+c))}});for(var e in b)"domain"in b[e]||(Components.utils.reportError(Error("no domain defined for key org.gnucitizen.websecurify.firefox.whitelist."+e)),delete b[e]);return b};this.buildRegularExpressionFromDomainWhitelist=function(b){var e=[],c;for(c in b){var a=b[c],d;d=a.sslonly?"https://":"https?://";a=a.domain;if(!a)return;(a=a.trim())&&e.push(d+
a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"))}return RegExp("^("+e.join("|")+")(/|$)","i")};this.isUrlInScope=function(b){"domainWhitelistRegexp"in this||(this.domainWhitelistRegexp=this.buildRegularExpressionFromDomainWhitelist(this.getDomainWhitelist()));return this.domainWhitelistRegexp.test(b)}};
