var EXPORTED_SYMBOLS=["weaponryCommon"],CR=Components.results,CC=Components.classes,CI=Components.interfaces;Components.utils.import("resource://gre/modules/XPCOMUtils.jsm");Components.utils.import("resource://gre/modules/AddonManager.jsm");function Observer(c,e){this.topics=c;this.handler=e}
Observer.prototype={QueryInterface:XPCOMUtils.generateQI([CI.nsIObserver]),get wrappedJSObject(){return this},cleanup:function(){if(!weaponryCommon.isFunction(this.handler)&&"handleObserverCleanup"in this.handler)try{this.handler.handleObserverCleanup()}catch(c){Components.utils.reportError(c)}this.handler=this.topics=null},observe:function(c,e,a){if(weaponryCommon.isFunction(this.handler))try{this.handler(c,e,a)}catch(b){Components.utils.reportError(b)}else try{this.handler.handleObserverNotification(c,
e,a)}catch(d){Components.utils.reportError(d)}},register:function(){for(var c=this.topics,e=c.length,a=0;a<e;a+=1)weaponryCommon.observerService.addObserver(this,c[a],!1)},unregister:function(){for(var c=this.topics,e=c.length,a=0;a<e;a+=1)weaponryCommon.observerService.removeObserver(this,c[a],!1)},install:function(c){function e(d){if(d.target==c.document){c.removeEventListener("close",a,!1);try{b.unregister()}catch(i){Components.utils.reportError(i)}b.cleanup()}}function a(a){if(a.target==c){c.removeEventListener("unload",
e,!1);try{b.unregister()}catch(i){Components.utils.reportError(i)}b.cleanup()}}this.register();var b=this;c.addEventListener("unload",e,!1);c.addEventListener("close",a,!1)}};function HttpObserver(c){this.handler=c}
HttpObserver.prototype={cleanup:function(){this.handler=null},handleObserverCleanup:function(){this.cleanup()},handleObserverNotification:function(c){var e;try{e=c.QueryInterface(CI.nsIHttpChannel)}catch(a){return}if(c=weaponryCommon.getChannelWindow(e))if(c.location.protocol in{"http:":1,"https:":1}||"about:blank"==c.location){var b=weaponryCommon.getParentChromeWindow(c.top);if(weaponryCommon.isFunction(this.handler))try{this.handler(e,c,b)}catch(d){Components.utils.reportError(d)}else try{this.handler.handleHttpObserverNotification(e,
c,b)}catch(i){Components.utils.reportError(i)}}else if(weaponryCommon.isFunction(this.handler))try{this.handler(e,c,c)}catch(f){Components.utils.reportError(f)}else try{this.handler.handleHttpObserverNotification(e,c,c)}catch(l){Components.utils.reportError(l)}else if(weaponryCommon.isFunction(this.handler))try{this.handler(e)}catch(g){Components.utils.reportError(g)}else try{this.handler.handleHttpObserverNotification(e)}catch(h){Components.utils.reportError(h)}}};
function ProgressListener(c,e,a){this.browser=c;this.notifications=e;this.handler=a}
ProgressListener.prototype={QueryInterface:XPCOMUtils.generateQI([CI.nsIWebProgressListener,CI.nsISupportsWeakReference]),get wrappedJSObject(){return this},cleanup:function(){if("onCleanup"in this.handler)try{this.handler.onCleanup.apply(this.handler,arguments)}catch(c){Components.utils.reportError(c)}this.handler=this.notifications=this.browser=null},onStateChange:function(){if("onStateChange"in this.handler)try{this.handler.onStateChange.apply(this.handler,arguments)}catch(c){Components.utils.reportError(c)}},
onProgressChange:function(){if("onProgressChange"in this.handler)try{this.handler.onProgressChange.apply(this.handler,arguments)}catch(c){Components.utils.reportError(c)}},onLocationChange:function(){if("onLocationChange"in this.handler)try{this.handler.onLocationChange.apply(this.handler,arguments)}catch(c){Components.utils.reportError(c)}},onStatusChange:function(){if("onStatusChange"in this.handler)try{this.handler.onStatusChange.apply(this.handler,arguments)}catch(c){Components.utils.reportError(c)}},
onSecurityChange:function(){if("onSecurityChange"in this.handler)try{this.handler.onSecurityChange.apply(this.handler,arguments)}catch(c){Components.utils.reportError(c)}},register:function(){this.browser.addProgressListener(this,this.notifications)},unregister:function(){this.browser.removeProgressListener(this)},install:function(c){function e(d){if(d.target==c.document){c.removeEventListener("close",a,!1);try{b.unregister()}catch(i){Components.utils.reportError(i)}b.cleanup()}}function a(a){if(a.target==
c){c.removeEventListener("unload",e,!1);try{b.unregister()}catch(i){Components.utils.reportError(i)}b.cleanup()}}this.register();var b=this;c.addEventListener("unload",e,!1);c.addEventListener("close",a,!1)}};function Timer(c,e){this.interval=c;this.handler=e;this.timer=weaponryCommon.createInstance("@mozilla.org/timer;1","nsITimer")}
Timer.prototype={QueryInterface:XPCOMUtils.generateQI([CI.nsITimerCallback]),get wrappedJSObject(){return this},cleanup:function(){if(!weaponryCommon.isFunction(this.handler)&&"handleTimerCleanup"in this.handler)try{this.handler.handleTimerCleanup()}catch(c){Components.utils.reportError(c)}this.timer=this.handler=this.interval=null},notify:function(c){weaponryCommon.isFunction(this.handler)?this.handler(c):this.handler.handleTimerNotification(c)},fire:function(){this.timer.initWithCallback(this,this.interval,
CI.nsITimer.TYPE_ONE_SHOT)},cancel:function(){this.timer.cancel()},register:function(){this.timer.initWithCallback(this,this.interval,CI.nsITimer.TYPE_REPEATING_SLACK)},unregister:function(){this.cancel()},start:function(){this.register()},stop:function(){this.unregister()},install:function(c){function e(d){if(d.target==c.document){c.removeEventListener("close",a,!1);try{b.unregister()}catch(i){Components.utils.reportError(i)}b.cleanup()}}function a(a){if(a.target==c){c.removeEventListener("unload",
e,!1);try{b.unregister()}catch(i){Components.utils.reportError(i)}b.cleanup()}}this.register();var b=this;c.addEventListener("unload",e,!1);c.addEventListener("close",a,!1)}};function Thread(c,e){this.thread=c;this.handler=e}
Thread.prototype={QueryInterface:XPCOMUtils.generateQI([CI.nsIRunnable]),get wrappedJSObject(){return this},cleanup:function(){if(!weaponryCommon.isFunction(this.handler)&&"cleanup"in this.handler)try{this.handler.cleanup()}catch(c){Components.utils.reportError(c)}this.handler=this.thread=null},run:function(){try{weaponryCommon.isFunction(this.handler)?this.handler(this.thread):this.handler.run(this.thread)}catch(c){Components.utils.reportError(c)}this.cleanup()}};
function ResponseDataTraceableListener(c,e){this.handler=c;this.receivedDataChunks=[];this.originalListener=e}
ResponseDataTraceableListener.prototype={QueryInterface:XPCOMUtils.generateQI([CI.nsIStreamListener]),get wrappedJSObject(){return this},cleanup:function(){if(!weaponryCommon.isFunction(this.handler)&&"handleResponseDataCleanup"in this.handler)try{this.handler.handleResponseDataCleanup()}catch(c){Components.utils.reportError(c)}this.originalListener=this.receivedDataChunks=this.handler=null},onDataAvailable:function(c,e,a,b,d){var i=weaponryCommon.createInstance("@mozilla.org/binaryinputstream;1",
"nsIBinaryInputStream"),f=weaponryCommon.createInstance("@mozilla.org/storagestream;1","nsIStorageStream"),l=weaponryCommon.createInstance("@mozilla.org/binaryoutputstream;1","nsIBinaryOutputStream");i.setInputStream(a);f.init(8192,d,null);l.setOutputStream(f.getOutputStream(0));a=i.readBytes(d);this.receivedDataChunks.push(a);l.writeBytes(a,d);try{if(this.originalListener)this.originalListener.onDataAvailable(c,e,f.newInputStream(0),b,d)}catch(g){Components.utils.reportError(g)}},onStartRequest:function(c,
e){try{if(this.originalListener)this.originalListener.onStartRequest(c,e)}catch(a){Components.utils.reportError(a)}},onStopRequest:function(c,e,a){var b=this.receivedDataChunks.join();if(weaponryCommon.isFunction(this.handler))try{this.handler(b,c)}catch(d){Components.utils.reportError(d)}else try{this.handler.handleResponseData(b,c)}catch(i){Components.utils.reportError(i)}try{if(this.originalListener)this.originalListener.onStopRequest(c,e,a)}catch(f){Components.utils.reportError(f)}this.cleanup()}};
function HeadersVisitor(){this.headers={};this.headersBlock=""}HeadersVisitor.prototype={QueryInterface:XPCOMUtils.generateQI([CI.nsIHttpHeaderVisitor]),get wrappedJSObject(){return this},visitHeader:function(c,e){this.headers[c]=e;this.headersBlock+=c+": "+e+"\r\n"}};function HttpChannelTransactionDetailsGetter(c,e){this.handler=c;this.maximumSize=e;this.request={};this.response={}}
HttpChannelTransactionDetailsGetter.prototype={cleanup:function(){if(!weaponryCommon.isFunction(this.handler)&&"handleHttpChannelTransactionCleanup"in this.handler)try{this.handler.handleHttpChannelTransactionCleanup()}catch(c){Components.utils.reportError(c)}this.response=this.request=this.maximumSize=this.handler=null},initiate:function(c){this.getHttpChannelRequestDetails(c)},getHttpChannelRequestDetails:function(c){try{this.request=weaponryCommon.getHttpChannelRequestParts(c)}catch(e){Components.utils.reportError(e);
this.cleanup();return}weaponryCommon.getHttpChannelRequestData(c,this,this.maximumSize)},getHttpChannelResponseDetails:function(c){try{this.response=weaponryCommon.getHttpChannelResponseParts(c)}catch(e){Components.utils.reportError(e),this.cleanup()}},handleRequestData:function(c,e){this.request.data=c;weaponryCommon.getHttpChannelResponseData(e,this,this.maximumSize)},handleResponseData:function(c,e){this.getHttpChannelResponseDetails(e);if(!weaponryCommon.isEmpty(this.response)){this.response.data=
c;300<=this.response.code&&399>=this.response.code&&(this.response.data="");if(weaponryCommon.isFunction(this.handler))try{this.handler(this.request,this.response,e)}catch(a){Components.utils.reportError(a)}else try{this.handler.handleHttpChannelTransaction(this.request,this.response,e)}catch(b){Components.utils.reportError(b)}this.cleanup()}}};function StringOutputStream(){this.data=""}
StringOutputStream.prototype={cleanup:function(){this.data=null},close:function(){},flush:function(){},write:function(c){this.data+=c}};
var HexUtil={lng2hex:function(c){for(c=c.toString(16);7!=c.length;)c="0"+c;return c},chr2hex:function(c){c=c.charCodeAt(0).toString(16);1==c.length?c="0"+c:2<c.length&&(c=c[c.length-2]+c[c.length-1]);return c},chr2chr:function(c){var e=c.charCodeAt(0);return 33<=e&&126>=e?c:"."},dump:function(c){for(var c=c.toString(),e="",a=0;a<c.length;a+=16){for(var e=e+(this.lng2hex(a)+": "),b=0;16>b;b++)e=a+b<c.length?e+(this.chr2hex(c[a+b])+" "):e+"   ";e+=" ";for(b=0;16>b;b++)a+b<c.length&&(e+=this.chr2chr(c[a+
b]));e+="\n"}return e}},runtimePrefs={},weaponryCommon=new function(){function c(a){return a.toUpperCase()}var e=this;this.isObject=function(a){return null!==a&&"object"==typeof a};this.isHash=function(a){return null!==a&&"object"==typeof a&&a.constructor&&/^function\sObject/.test(a.constructor.toString())};this.isArray=function(a){return null!==a&&"object"==typeof a&&a.constructor&&/^function\sArray/.test(a.constructor.toString())};this.isString=function(a){return null!==a&&("string"==typeof a||
"object"==typeof a&&a.constructor&&/^function\sString/.test(a.constructor.toString()))};this.isNumber=function(a){return null!==a&&("number"==typeof a||"object"==typeof a&&a.constructor&&/^function\sNumber/.test(a.constructor.toString()))};this.isBoolean=function(a){return null!==a&&("boolean"==typeof a||"object"==typeof a&&a.constructor&&/^function\sBoolean/.test(a.constructor.toString()))};this.isArguments=function(a){return null!==a&&"object"==typeof a&&void 0!=a.length&&void 0!=a.callee};this.isFunction=
function(a){return null!==a&&"function"==typeof a&&a.constructor&&/^function\sFunction/.test(a.constructor.toString())};this.isNone=function(a){return void 0==a||null==a};this.isEmpty=function(a){if(this.isNone(a))return!0;if(this.isString(a)||this.isArray(a))return 1>a.length;if(this.isNumber(a))return!1;if(this.isObject(a)){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}return!1};this.getIface=function(a){return this.isString(a)?CI[a]:a};this.getService=function(a,b){var d=CC[a];try{return b?
d.getService(this.getIface(b)):d.getService().wrappedJSObject}catch(c){return Components.utils.reportError(c),Components.utils.reportError("cannot get service for "+a+" with "+(b?"interface "+b:"with wrappedJSObject")),null}};this.createInstance=function(a,b){var d=CC[a];try{return b?d.createInstance(this.getIface(b)):d.createInstance().wrappedJSObject}catch(c){return Components.utils.reportError(c),Components.utils.reportError("cannot create instance for "+a+" with "+(b?"interface "+b:"with wrappedJSObject")),
null}};this.createServiceGetter=function(a,b,d,c){XPCOMUtils.defineLazyServiceGetter(this,a,b,d);c&&this[a].QueryInterface(this.getIface(c))};this.componentManager=Components.manager.QueryInterface(CI.nsIComponentRegistrar);this.createServiceGetter("categoryManager","@mozilla.org/categorymanager;1","nsICategoryManager");this.createServiceGetter("appStartup","@mozilla.org/toolkit/app-startup;1","nsIAppStartup");this.createServiceGetter("xulRuntime","@mozilla.org/xre/app-info;1","nsIXULRuntime");this.createServiceGetter("xulAppInfo",
"@mozilla.org/xre/app-info;1","nsIXULAppInfo");this.createServiceGetter("appShellService","@mozilla.org/appshell/appShellService;1","nsIAppShellService");this.createServiceGetter("systemInfo","@mozilla.org/system-info;1","nsIPropertyBag2");this.createServiceGetter("ioService","@mozilla.org/network/io-service;1","nsIIOService");this.createServiceGetter("protocolProxyService","@mozilla.org/network/protocol-proxy-service;1","nsIProtocolProxyService");this.createServiceGetter("socketTransportService",
"@mozilla.org/network/socket-transport-service;1","nsISocketTransportService");this.createServiceGetter("windowWatcher","@mozilla.org/embedcomp/window-watcher;1","nsIWindowWatcher");this.createServiceGetter("windowMediator","@mozilla.org/appshell/window-mediator;1","nsIWindowMediator");this.createServiceGetter("stringBundleService","@mozilla.org/intl/stringbundle;1","nsIStringBundleService");this.createServiceGetter("promptService","@mozilla.org/embedcomp/prompt-service;1","nsIPromptService");this.createServiceGetter("consoleService",
"@mozilla.org/consoleservice;1","nsIConsoleService");this.createServiceGetter("preferencesService","@mozilla.org/preferences-service;1","nsIPrefService","nsIPrefBranch");this.createServiceGetter("updateManager","@mozilla.org/updates/update-manager;1","nsIUpdateManager");this.createServiceGetter("updatePrompt","@mozilla.org/updates/update-prompt;1","nsIUpdatePrompt");this.createServiceGetter("certOverrideService","@mozilla.org/security/certoverride;1","nsICertOverrideService");this.createServiceGetter("observerService",
"@mozilla.org/observer-service;1","nsIObserverService");this.createServiceGetter("threadManager","@mozilla.org/thread-manager;1","nsIThreadManager");this.createServiceGetter("clipboardHelper","@mozilla.org/widget/clipboardhelper;1","nsIClipboardHelper");this.createServiceGetter("subscriptLoader","@mozilla.org/moz/jssubscript-loader;1","mozIJSSubScriptLoader");this.createServiceGetter("chromeRegistry","@mozilla.org/chrome/chrome-registry;1","nsIChromeRegistry");this.createServiceGetter("uriLoader",
"@mozilla.org/uriloader;1","nsIURILoader");this.createServiceGetter("externalProtocolService","@mozilla.org/uriloader/external-protocol-service;1","nsIExternalProtocolService");this.createServiceGetter("proxyManager","@mozilla.org/xpcomproxy;1","nsIProxyObjectManager");this.createServiceGetter("directoryService","@mozilla.org/file/directory_service;1","nsIDirectoryService","nsIProperties");this.createServiceGetter("mozstorageService","@mozilla.org/storage/service;1","mozIStorageService");this.createServiceGetter("atomService",
"@mozilla.org/atom-service;1","nsIAtomService");this.createServiceGetter("cookieService","@mozilla.org/cookieService;1","nsICookieService");this.createServiceGetter("navHistoryService","@mozilla.org/browser/nav-history-service;1","nsINavHistoryService");this.createServiceGetter("faviconService","@mozilla.org/browser/favicon-service;1","nsIFaviconService");this.createServiceGetter("cookieManager","@mozilla.org/cookiemanager;1","nsICookieManager");this.createServiceGetter("effectiveTldService","@mozilla.org/network/effective-tld-service;1",
"nsIEffectiveTLDService");this.createServiceGetter("rdfService","@mozilla.org/rdf/rdf-service;1","nsIRDFService");this.createServiceGetter("streamConverterService","@mozilla.org/streamConverters;1","nsIStreamConverterService");this.createServiceGetter("streamTransportService","@mozilla.org/network/stream-transport-service;1","nsIStreamTransportService");this.brandBundle=this.stringBundleService.createBundle("chrome://branding/locale/brand.properties");this.enumerateQueryIfaces=function(a){var b=[],
d;for(d in CI)try{a.QueryInterface(CI[d]),b.push(d)}catch(c){}return b};this.enumerateGetIfaces=function(a){try{a.QueryInterface(CI.nsIInterfaceRequestor)}catch(b){return[]}var d=[],c;for(c in CI)try{a.getInterface(CI[c]),d.push(c)}catch(f){}return d};this.enumerateComponents=function(a){for(var b=[],d=this.categoryManager.enumerateCategory(a);d.hasMoreElements();){var c=d.getNext().QueryInterface(CI.nsISupportsCString),f=this.categoryManager.getCategoryEntry(a,c),e=f.split(",")[0],g=f.split(",")[1];
g||(e="instance",g=f);b.push({category:a,entry:c,type:e,contractID:g})}return b};this.retrieveComponents=function(a,b){for(var d=[],c=this.enumerateComponents(a),f=c.length,e=0;e<f;e+=1){var g=c[e];"service"==g.type?d.push(this.getService(g.contractID,b)):d.push(this.createInstance(g.contractID,b))}return d};this.quitNormally=function(){this.appStartup.quit(Components.interfaces.nsIAppStartup.eAttemptQuit)};this.quitForcefully=function(){this.appStartup.quit(Components.interfaces.nsIAppStartup.eForceQuit)};
this.quit=function(){return this.quitNormally()};this.checkForUpdates=function(){this.updateManager&&(this.updateManager.activeUpdate&&"pending"==this.updateManager.activeUpdate.state?this.updatePrompt.showUpdateDownloaded(this.updateManager.activeUpdate):this.updatePrompt.checkForUpdates())};this.getWindowByUrl=function(a){for(var b=this.windowMediator.getEnumerator(null);b.hasMoreElements();){var d=b.getNext();if(d.location==a)return d}return null};this.getWindowByName=function(a){return this.windowWatcher.getWindowByName(a,
null)};this.getWindowByType=function(a){return this.windowMediator.getMostRecentWindow(a)};this.getWindowByDocShell=function(a){return!(a instanceof CI.nsIInterfaceRequestor)?null:a.getInterface(CI.nsIDOMWindow)};this.getAllWindows=function(){for(var a=[],b=this.windowMediator.getEnumerator(null);b.hasMoreElements();)a.push(b.getNext());return a};this.getAllWindowsByType=function(a){for(var b=[],a=this.windowMediator.getEnumerator(a);a.hasMoreElements();)b.push(a.getNext());return b};this.reloadAllWindows=
function(){for(var a=this.getAllWindows(),b=a.length,d=0;d<b;d+=1)a[d].location.reload(!0)};this.getHiddenChromeWindow=function(){return this.appShellService.hiddenDOMWindow};this.getDefaultChromeWindow=function(){return this.getWindowByUrl(this.getPref("toolkit.defaultChromeURI"))};this.getRootChromeWindow=function(a){return a.QueryInterface(CI.nsIInterfaceRequestor).getInterface(CI.nsIWebNavigation).QueryInterface(CI.nsIDocShellTreeItem).rootTreeItem.QueryInterface(CI.nsIInterfaceRequestor).getInterface(CI.nsIDOMWindow)};
this.getParentChromeWindow=function(a){a instanceof CI.nsIDOMChromeWindow||(a=a.top);var b=a.QueryInterface(CI.nsIInterfaceRequestor).getInterface(CI.nsIWebNavigation).QueryInterface(CI.nsIDocShellTreeItem).parent,b=b?b.QueryInterface(CI.nsIInterfaceRequestor).getInterface(CI.nsIDOMWindow):a.parent;return b.wrappedJSObject?b.wrappedJSObject:b};this.getChannelWindow=function(a){var a=a.QueryInterface(CI.nsIChannel),b=null,d=null;try{a.notificationCallbacks&&(b=a.notificationCallbacks.getInterface(CI.nsIWebProgress))}catch(c){}try{!b&&
a.loadGroup&&a.loadGroup.groupObserver&&(b=a.loadGroup.groupObserver.QueryInterface(CI.nsIWebProgress))}catch(f){}try{b&&(d=b.DOMWindow)}catch(e){}return d};this.lookupParentWindowByType=function(a,b){for(;;){var d=this.getParentChromeWindow(a),c=d.document.documentElement;if(c.hasAttribute("windowtype")&&c.getAttribute("windowtype")==b)return d;a=d;if(d==a)return null}};this.openWindow=function(a,b,d,c){var f=null;if(4<arguments.length)for(var f=this.createInstance("@mozilla.org/array;1","nsIMutableArray"),
e=arguments.length,g=4;g<e;g+=1){var h=this.createInstance("@mozilla.org/variant;1","nsIWritableVariant");h.setFromVariant(arguments[g]);f.appendElement(h,!1)}return this.windowWatcher.openWindow(a,b,d,c,f)};this.openWindowOnce=function(a,b,d,c,f){var e=this.getWindowByType(b);if(e)return e.focus(),e;for(var e=[a],g=arguments.length,h=2;h<g;h+=1)e.push(arguments[h]);return this.openWindow.apply(this,e)};this.openAddOnsWindow=function(){return this.openWindowOnce(null,"Addons:Manager","chrome://mozapps/content/extensions/extensions.xul",
null,"all,chrome,resizable,centerscreen,toolbar=yes")};this.openErrorConsoleWindow=function(){return this.openWindowOnce(null,"global:console","chrome://global/content/console.xul",null,"all,chrome,resizable,centerscreen,toolbar=yes")};this.getWindowDocumentCoreURI=function(a){return a.QueryInterface(CI.nsIInterfaceRequestor).getInterface(CI.nsIWebNavigation).QueryInterface(CI.nsIDocShell).currentDocumentChannel.URI.spec};this.getBundle=function(a){return this.stringBundleService.createBundle(a)};
this.getBrandString=function(a){return this.brandBundle.GetStringFromName(a)};this.brandFullName=this.getBrandString("brandFullName");this.brandShortName=this.getBrandString("brandShortName");this.vendorShortName=this.getBrandString("vendorShortName");this.brandedAlert=function(a,b){return this.alert(a,this.brandShortName,b)};this.brandedAlertCheck=function(a,b,d){return this.alertCheck(a,this.brandShortName,b,d)};this.alert=function(a,b,d){return 2==arguments.length?this.brandedAlert(a,b):this.promptService.alert(a,
b,d)};this.alertCheck=function(a,b,d,c){if(3==arguments.length)return this.brandedAlertCheck(a,b,d);var f={value:!1,successful:!1};f.successful=this.promptService.alertCheck(a,b,d,c,f);return f};this.brandedConfirm=function(a,b){return this.confirm(a,this.brandShortName,b)};this.brandedConfirmCheck=function(a,b,d){return this.confirmCheck(a,this.brandShortName,b,d)};this.confirm=function(a,b,d){return 2==arguments.length?this.brandedConfirm(a,b):this.promptService.confirm(a,b,d)};this.confirmCheck=
function(a,b,d,c){if(3==arguments.length)return this.brandedConfirmCheck(a,b,d);var f={value:!1,successful:!1};f.successful=this.promptService.confirmCheck(a,b,d,c,f);return f};this.brandedPrompt=function(a,b,d){return this.prompt(a,this.brandShortName,b,d)};this.prompt=function(a,b,d,c){if(3==arguments.length)return this.brandedPrompt(a,b,d);var f={value:c,successful:!1};f.successful=this.promptService.prompt(a,b,d,f,null,{});return f};this.logError=function(a){Components.utils.reportError(a)};this.logException=
function(a){Components.utils.reportError(a)};this.logMessage=function(a){for(var b=[],d=arguments.length,c=0;c<d;c+=1)b.push(arguments[c]);b=b.join(" ");dump&&dump(b+"\n");return this.consoleService.logStringMessage(b)};this.logString=function(a){return this.logMessage.apply(this,arguments)};this.logObject=function(a){for(var b=[],d=arguments.length,c=0;c<d;c+=1)b.push(JSON.stringify(arguments[c]));return this.logMessage.apply(this,b)};this.logElement=function(a){for(var b=[],d=arguments.length,c=
0;c<d;c+=1)b.push((new a.ownerDocument.defaultView.XMLSerializer).serializeToString(arguments[c]));return this.logMessage.apply(this,b)};this.logBinary=function(a){this.logMessage(HexUtil.dump(a))};this.logData=function(a){this.logBinary(a)};this.getPref=function(a,b){try{if(!b){var d=this.preferencesService.getPrefType(a);if(d==CI.nsIPrefBranch.PREF_STRING)b="Char";else if(d==CI.nsIPrefBranch.PREF_INT)b="Int";else if(d==CI.nsIPrefBranch.PREF_BOOL)b="Bool";else{if(d==CI.nsIPrefBranch.PREF_INVALID)return null;
b="Char"}}}catch(c){return Components.utils.reportError(Error("preference "+a+" does not exist")),null}try{return this.preferencesService["get"+b+"Pref"](a)}catch(f){return Components.utils.reportError(f),null}};this.setPref=function(a,b,d){if(d){if("string"==d)return this.preferencesService.setCharPref(a,b);if("number"==d)return this.preferencesService.setIntPref(a,b);if("boolean"==d)return this.preferencesService.setBoolPref(a,b);throw Error("unknown type: "+d);}if(this.isString(b))return this.preferencesService.setCharPref(a,
b);if(this.isNumber(b))return this.preferencesService.setIntPref(a,b);if(this.isBoolean(b))return this.preferencesService.setBoolPref(a,b);throw Error("unknown type: "+d);};this.lockPref=function(a){this.preferencesService.lockPref(a)};this.allowCertificate=function(a,b,d,c,f){var e=0;c.isUntrusted&&(e|=this.certOverrideService.ERROR_UNTRUSTED);c.isDomainMismatch&&(e|=this.certOverrideService.ERROR_MISMATCH);c.isNotValidAtThisTime&&(e|=this.certOverrideService.ERROR_TIME);this.certOverrideService.rememberValidityOverride(a,
b,d,e,f)};this.allowChannelCertificate=function(a,b){var d=a.URI.QueryInterface(Components.interfaces.nsIURI),c=d.host,f=d.port;-1==f&&(d=d.scheme.toUpperCase(),"HTTP"==d?f=80:"HTTPS"==d?f=443:"FTP"==d&&(f=21));a.securityInfo&&(d=a.securityInfo.QueryInterface(Components.interfaces.nsISSLStatusProvider).SSLStatus.QueryInterface(Components.interfaces.nsISSLStatus),this.allowCertificate(c,f,d.serverCert,d,b))};this.createObserver=function(a,b){return new Observer(a,b)};this.notifyObservers=function(a,
b,d){if(this.isArray(b))for(var c=b.length,f=0;f<c;f+=1)this.observerService.notifyObservers(a,b[f],d);else this.observerService.notifyObservers(a,b,d)};this.createHttpObserver=function(a,b,d,c){var f=[];a&&f.push("http-on-modify-request");b&&f.push("http-on-examine-response");d&&f.push("http-on-examine-cached-response");return this.createObserver(f,new HttpObserver(c))};this.createProgressListener=function(a,b,d){return new ProgressListener(a,b,d)};this.createTimer=function(a,b){return new Timer(a,
b)};this.dispatchToThread=function(a,b){return a.dispatch(new Thread(a,b),CI.nsIThread.DISPATCH_NORMAL)};this.dispatchToMainThread=function(a){return this.dispatchToThread(this.threadManager.mainThread,a)};this.getProxyOnUiThread=function(a,b,d){var c=CI.nsIProxyObjectManager.NS_PROXY_ALWAYS,c=d?c|CI.nsIProxyObjectManager.NS_PROXY_ASYNC:c|CI.nsIProxyObjectManager.NS_PROXY_SYNC;return this.proxyManager.getProxyForObject(this.threadManager.mainThread,this.getIface(b),a,c)};this.getHttpChannelRequestData=
function(a,b){if(a.URI.scheme.toLowerCase()in{http:1,https:1})if(a instanceof CI.nsIUploadChannel){var d=a.QueryInterface(CI.nsIUploadChannel),c=!1;d.uploadStream instanceof CI.nsIMIMEInputStream&&(c=!0);if(d.uploadStream instanceof CI.nsISeekableStream){d=d.uploadStream.QueryInterface(CI.nsISeekableStream);try{d.seek(0,0)}catch(f){}var e=this.createInstance("@mozilla.org/binaryinputstream;1","nsIBinaryInputStream");e.setInputStream(d);d=e.readBytes(e.available());c&&(d=0==d.indexOf("\r\n")?d.substring(2,
d.length):d.substring(d.indexOf("\r\n\r\n")+4,d.length));if(this.isFunction(b))try{b(d,a)}catch(g){Components.utils.reportError(g)}else try{b.handleRequestData(d,a)}catch(h){Components.utils.reportError(h)}}else if(d="",this.isFunction(b))try{b(d,a)}catch(j){Components.utils.reportError(j)}else try{b.handleRequestData(d,a)}catch(k){Components.utils.reportError(k)}}else if(d="",this.isFunction(b))try{b(d,a)}catch(m){Components.utils.reportError(m)}else try{b.handleRequestData(d,a)}catch(n){Components.utils.reportError(n)}};
this.getHttpChannelResponseData=function(a,b){if(a.URI.scheme.toLowerCase()in{http:1,https:1}&&a instanceof CI.nsITraceableChannel){var d=a.QueryInterface(CI.nsITraceableChannel),c=new ResponseDataTraceableListener(b);try{c.originalListener=d.setNewListener(c)}catch(f){Components.utils.reportError(f)}}};this.getHttpChannelRequestParts=function(a){var b=a.QueryInterface(CI.nsIHttpChannel),d=new HeadersVisitor;b.visitRequestHeaders(d);var c=d.headers,d=d.headersBlock,d=d.substring(0,d.length-2);if(b instanceof
CI.nsIUploadChannel){var f=b.QueryInterface(CI.nsIUploadChannel);if(f.uploadStream instanceof CI.nsIMIMEInputStream&&(f=f.uploadStream.QueryInterface(CI.nsIMIMEInputStream),f instanceof CI.nsISeekableStream)){f=f.QueryInterface(CI.nsISeekableStream);try{f.seek(0,0)}catch(e){}var g=this.createInstance("@mozilla.org/binaryinputstream;1","nsIBinaryInputStream");g.setInputStream(f);f=g.readBytes(g.available());if(0<f.indexOf("\r\n"))for(var f=f.substring(0,f.indexOf("\r\n\r\n")+2),d=d+f,f=f.split("\r\n").slice(0,
-1),g=f.length,h=0;h<g;h+=1){var j=f[h],k=j.indexOf(":"),m=j.substring(0,k).trim(),j=j.substring(k+1,j.length).trim();c[m]=j}}}f=a.URI.port;-1==a.URI.port&&(g=a.URI.scheme.toLowerCase(),"ftp"==g?f=21:"http"==g?f=80:"https"==g&&(f=443));return{method:b.requestMethod,url:a.URI.spec,scheme:a.URI.scheme,credentials:a.URI.userPass,username:a.URI.userPass.split(":")[0],password:a.URI.userPass.split(":").slice(1).join(":"),host:a.URI.host,port:f,path:a.URI.path.split("?")[0],query:a.URI.path.split("?").slice(1).join("?"),
version:"HTTP/1.1",headers:c,headersBlock:d}};this.getHttpChannelResponseParts=function(a){var a=a.QueryInterface(CI.nsIHttpChannel),b=new HeadersVisitor;a.visitResponseHeaders(b);var d=b.headers,b=b.headersBlock,b=b.substring(0,b.length-2);return{version:"HTTP/1.1",code:a.responseStatus,message:a.responseStatusText,headers:d,headersBlock:b,contentType:a.contentType}};this.getHttpChannelTransactionDetails=function(a,b,d){(new HttpChannelTransactionDetailsGetter(b,d)).initiate(a)};this.isXMLHttpRequest=
function(a){if(a instanceof CI.nsIXMLHttpRequest||a instanceof CI.nsIJSXMLHttpRequest)return!0;if(a instanceof CI.nsIChannel&&a.notificationCallbacks instanceof CI.nsIInterfaceRequestor){var b=null;try{b=a.notificationCallbacks.getInterface(CI.nsIXMLHttpRequest)}catch(d){}return this.isXMLHttpRequest(b)}return!1};this.isMediaContentType=function(a){return a.trim().match(/^(image|video|audio)\//i)};this.isBinaryContentType=function(a){return a.trim().match(/(pdf|zip)/i)};this.consolidateHttpParts=
function(a,b,d,e){var d={requestData:d,responseData:e},f;for(f in a)d["request"+f.replace(/^\w/,c)]=a[f];for(f in b)d["response"+f.replace(/^\w/,c)]=b[f];return d};this.closeHttpChannel=function(a){a.cancel(CR.NS_OK)};this.abortHttpChannel=function(a){a.cancel(CR.NS_BINDING_ABORTED)};this.copyToClipboard=function(a){this.clipboardHelper.copyString(a)};this.createStringOutputStream=function(){return new StringOutputStream};this.createStringInputStream=function(a){var a=a.toString(),b=this.createInstance("@mozilla.org/io/string-input-stream;1",
"nsIStringInputStream");b.setData(a,a.length);return b};this.convertStringCharset=function(a,b,d){var c=this.createStringOutputStream(),f=this.createInstance("@mozilla.org/intl/converter-output-stream;1","nsIConverterOutputStream");f.init(c,b,1024,CI.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);f.writeString(a);b=this.createStringInputStream(c.data);a=this.createInstance("@mozilla.org/intl/converter-input-stream;1","nsIConverterInputStream");a.init(b,d,1024,CI.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);
d="";for(b={};0!=a.readString(1024,b);)d+=b.value;return d};this.loadSubscript=function(a,b){this.subscriptLoader.loadSubScript(a,b)};this.makeFile=function(a){if(!(a instanceof CI.nsIFile)){var b=a,a=this.createInstance("@mozilla.org/file/local;1","nsILocalFile");a.initWithPath(b)}return a};this.getFileUri=function(a){return this.ioService.newFileURI(this.makeFile(a))};this.getChromeUriFile=function(a){var b=a;a instanceof CI.nsIURI||(b=this.ioService.newURI(a,"UTF-8",null));return this.makeFile(this.chromeRegistry.convertChromeURL(b).path)};
this.getChromeUriFilePath=function(a){return this.getChromeUriFile(a).path};this.executeFile=function(a){var b=null;if(a instanceof CI.nsIFile||a instanceof CI.nsILocalFile)b=a;else if(/^chrome:\/\//i.test(a))b=this.getChromeUriFile(a);else if(/^file:\/\//i.test(a)){var d=this.ioService.newURI(a,"UTF-8",null),b=this.createInstance("@mozilla.org/file/local;1","nsILocalFile");b.initWithPath(d.path)}else b=this.createInstance("@mozilla.org/file/local;1","nsILocalFile"),b.initWithPath(a);var d=Array.prototype.slice.call(arguments,
1),c=this.createInstance("@mozilla.org/process/util;1","nsIProcess");c.init(b);c.run(!1,d,d.length)};this.launchFile=function(){};this.openUriExternally=function(a){this.externalProtocolService.loadURI(this.ioService.newURI(a,null,null),null)};this.openUri=function(a){this.openUriExternally(a)};this.getProfileDirectory=function(){return this.directoryService.get("ProfD",CI.nsIFile)};this.getApplicationDirectory=function(){return this.directoryService.get("AChrom",CI.nsIFile).parent};this.openMozstorageConnection=
function(a){if(a instanceof CI.nsIFile)return this.mozstorageService.openDatabase(a);if(a instanceof CI.mozIStorageConnection)return this.mozstorageService.openDataBase(a.databaseFile);localFile=this.createInstance("@mozilla.org/file/local;1","nsILocalFile");localFile.initWithPath(a);return this.mozstorageService.openDatabase(localFile)};this.executeMozstorageStatement=function(a,b,d){if(!a.connectionReady)return[];var c=[],f=null;try{f=a.createStatement(b)}catch(e){throw Components.utils.reportError("error when creating statement: "+
b),e;}try{d||(d={});if(d)for(var g in d)f.params[g]=d[g];if(/^\s*(create|insert|update|delete)\s+/i.test(b))f.executeStep();else{var a=[],h;for(h=0;h<f.columnCount;h+=1)a.push(f.getColumnName(h));for(var j=a.length,k,m,n;f.executeStep();){k={};for(h=0;h<j;h+=1)m=a[h],n=f.row[m],k[m]=n;c.push(k)}}}catch(o){throw Components.utils.reportError(o),o;}finally{f.finalize()}return c};this.executeMozstorageStatementAsynchronously=function(a,b,d,c,f,e){if(a.connectionReady){var g=null;try{g=a.createStatement(b)}catch(h){throw Components.utils.reportError("error when creating statement: "+
b),h;}d||(d={});if(d)for(var j in d)g.params[j]=d[j];for(var k=[],a=0;a<g.columnCount;a+=1)k.push(g.getColumnName(a));var m=k.length;g.executeAsync({handleResult:function(a){for(var b=a.getNextRow();b;b=a.getNextRow())if(c){for(var d={},f=0;f<m;f+=1){var e=k[f],g=b.getResultByIndex(f);d[e]=g}c(d)}},handleError:function(a){e&&e(a)},handleCompletion:function(a){f&&f(a)}})}};this.saveDataToFile=function(a,b){var d=null;a instanceof CI.nsILocalFile?d=a:a instanceof CI.nsIURI?d=a.QueryInterface(CI.nsIFileURL).file:
(d=this.createInterface("@mozilla.org/file/local;1","nsILocalFile"),d.initWithPath(a));d.exists()||d.createUnique(CI.nsIFile.NORMAL_FILE_TYPE,600);var c=this.createInstance("@mozilla.org/network/safe-file-output-stream;1","nsIFileOutputStream");c.init(d,44,384,0);c.write(b,b.length);c instanceof CI.nsISafeOutputStream?c.finish():c.close()};this.readDataFromFile=function(a){var b=null;a instanceof CI.nsILocalFile?b=a:a instanceof CI.nsIURI?b=a.QueryInterface(CI.nsIFileURL).file:(b=this.createInterface("@mozilla.org/file/local;1",
"nsILocalFile"),b.initWithPath(a));a=this.createInstance("@mozilla.org/network/file-input-stream;1","nsIFileInputStream");a.init(b,-1,0,0);b=this.createInstance("@mozilla.org/intl/converter-input-stream;1","nsIConverterInputStream");b.init(a,"UTF-8",0,0);var a=[],c={},e=0;do e=b.readString(4294967295,c),a.push(c.value);while(0!=e);b.close();return a.join("")};this.clearCookies=function(){this.cookieManager.removeAll()};this.getCookieStringForUrl=function(a){a instanceof CI.nsIURI||(a=this.ioService.newURI(a,
null,null));return this.cookieServices.getCookieString(a,null)};this.readUrl=function(a,b){a instanceof CI.nsIURI||(a=this.ioService.newURI(a,null,null));var c=this.ioService.newChannelFromURI(a).open(),e=this.createInstance("@mozilla.org/binaryinputstream;1","nsIBinaryInputStream");e.setInputStream(c);for(var f=c.available(),l="";0<f;)l+=e.readBytes(f),f=c.available();(b=b?this.isFunction(b)?b:b.handle:null)&&b(l);return l};this.readUrlAsynchronously=function(a,b){a instanceof CI.nsIURI||(a=this.ioService.newURI(a,
null,null));var c={handler:this.isFunction(b)?b:b.handle,onStartRequest:function(){},onStopRequest:function(){},onDataAvailable:function(a,b,c,d,i){a=e.createInstance("@mozilla.org/binaryinputstream;1","nsIBinaryInputStream");a.setInputStream(c);this.handler(a.readBytes(i))}},i=this.ioService.newChannelFromURI(a);i.asyncOpen(c,i)};this.readFile=function(a,b){var c=this.readDataFromFile(a);b(c)};this.readFileAsynchronously=function(){};this.getPathSeparator=function(){var a=this.xulRuntime.OS;if("Darwin"==
a||"Linux"==a)return":";if("WINNT"==a)return";";throw Error("unsupported os");};this.getExecutableName=function(a){var b=this.xulRuntime.OS;if("Darwin"==b||"Linux"==b)return a;if("WINNT"==b)return a+".exe";throw Error("unsupported os");};this.recordHistroyForUrl=function(a){a instanceof CI.nsIURI||(a=this.ioService.newURI(a,null,null));this.navHistoryService.addURI(a,!1,!0,null)};this.recordFaviconForUrl=function(a){a instanceof CI.nsIURI||(a=this.ioService.newURI(a,null,null));this.faviconService.setAndLoadFaviconForPage(a,
this.ioService.newURI(a.prePath+"/favicon.ico",null,null),!1)};this.obtainFaviconForUrl=function(a){a instanceof CI.nsIURI||this.ioService.newURI(a,null,null)};this.getRuntimePref=function(a){return runtimePrefs[a]};this.setRuntimePref=function(a,b){runtimePrefs[a]=b};this.getBaseDomain=function(a){return a instanceof CI.nsIURI?this.effectiveTldService.getBaseDomain(a):a.match(/^https?:\/\//i)?this.effectiveTldService.getBaseDomain(this.ioService.newURI(a,null,null)):this.effectiveTldService.getBaseDomainFromHost(a)};
this.getPublicSuffix=function(a){return a instanceof CI.nsIURI?this.effectiveTldService.getPublicSuffix(a):a.match(/^https?:\/\//i)?this.effectiveTldService.getPublicSuffix(this.ioService.newURI(a,null,null)):this.effectiveTldService.getPublicSuffixFromHost(a)};this.toHexString=function(a){var b=[],c;for(c in a){var e=a.charCodeAt(c);b.push(("0"+e.toString(16)).slice(-2))}return b.join("")};this.md5=function(a){var b=this.createInstance("@mozilla.org/intl/scriptableunicodeconverter","nsIScriptableUnicodeConverter");
b.charset="UTF-8";a=b.convertToByteArray(a,{});b=e.createInstance("@mozilla.org/security/hash;1","nsICryptoHash");b.init(b.MD5);b.update(a,a.length);return this.toHexString(b.finish(!1))};this.parseRdf=function(a){var b=this.ioService.newURI("http://test",null,null),c=this.createInstance("@mozilla.org/rdf/datasource;1?name=xml-datasource","nsIRDFDataSource");this.createInstance("@mozilla.org/rdf/xml-parser;1","nsIRDFXMLParser").parseString(c,b,a);return c};this.createPipe=function(){var a=this.createInstance("@mozilla.org/pipe;1",
"nsIPipe");a.init(!0,!0,0,0,null);return a};this.createBufferedInputStream=function(a,b){!b&&0>b&&(b=4096);var c=this.createInstance("@mozilla.org/network/buffered-input-stream;1","nsIBufferedInputStream");c.init(a,b);return c};this.createMimeInputStream=function(a){var b=this.createInstance("@mozilla.org/network/mime-input-stream;1","nsIMIMEInputStream");b.setData(a);return b};this.createXmlHttpRequest=function(){return this.createInstance("@mozilla.org/xmlextras/xmlhttprequest;1","nsIXMLHttpRequest")};
this.walkSimpleEnumerator=function(a,b){for(;a.hasMoreElements();)b(a.getNext())};this.walkSimpleEnumeratorForStrings=function(a,b){this.walkSimpleEnumerator(a,function(a){b(a.QueryInterface(CI.nsISupportsString).toString())})};this.createSimpleEnumeratorForStrings=function(a){return{QueryInterface:XPCOMUtils.generateQI([CI.nsISimpleEnumerator]),index:0,hasMoreElements:function(){return a.length>this.index},getNext:function(){if(this.index>=a.length)throw CR.NS_ERROR_FAILURE;var b=a[this.index++];
return{QueryInterface:XPCOMUtils.generateQI([CI.nsISupportsString]),toString:function(){return b}}}}};this.bulkRetrieveExtensionBundleFile=function(a,b){var c=this.getApplicationDirectory();c.append("distribution");c.append("bundles");if(c.isDirectory()){var i=this;this.walkSimpleEnumerator(c.directoryEntries,function(c){c.QueryInterface(CI.nsIFile);c.isDirectory()&&(c.append(a),c.exists()&&c.isFile()&&i.readFile(c,function(a){b(a)}))})}AddonManager.getAllAddons(function(c){c.forEach(function(c){if("extension"==
c.type&&c.isActive){var c=c.getResourceURI("/"+a),d;try{d=e.readDataFromFile(c)}catch(f){return}b(d)}})})}};
